<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapping: Ancestral Ties</title>

    <link href='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js'></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --parchment:   #f2ede6;
            --parchment-2: #e2d9ce;
            --parchment-3: #cfc4b5;
            --ink:         #0f0c08;
            --ink-muted:   #3d3229;
            --ink-faint:   #7a6e64;
            --terra:       #8b3a1e;
            --terra-light: rgba(139, 58, 30, 0.10);
            --terra-mid:   rgba(139, 58, 30, 0.30);
            --border:      rgba(15, 12, 8, 0.20);
            --sidebar-w:   300px;

            /* Legend colors — warm, harmonized palette */
            --c-tribal:      #a84428;
            --c-university:  #3d2e22;
            --c-museum:      #7a5530;
            --c-federal:     #3a5040;
            --c-state:       #556645;
            --c-historical:  #6b4a28;
            --c-affiliation: #6b5542;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        body, html {
            height: 100%;
            overflow: hidden;
            font-family: 'DM Sans', sans-serif;
            color: var(--ink);
            background: var(--parchment);
        }

        #map { position: absolute; inset: 0; }

        /* ─── Header ──────────────────────────── */
        header {
            position: absolute;
            top: 0; left: 0; right: 0;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px 0 calc(var(--sidebar-w) + 20px);
            height: 52px;
            background: rgba(242, 237, 230, 0.97);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border);
            transition: padding-left 0.3s ease;
        }

        .sidebar-hidden header { padding-left: 20px; }

        .header-title {
            display: flex;
            align-items: baseline;
            gap: 10px;
        }

        .header-title h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.25rem;
            font-weight: 500;
            letter-spacing: 0.01em;
            color: var(--ink);
            white-space: nowrap;
        }

        .header-title span {
            font-size: 0.7rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--ink-faint);
            font-weight: 300;
        }

        nav { display: flex; gap: 4px; }

        nav a {
            font-size: 0.78rem;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            text-decoration: none;
            color: var(--ink-muted);
            padding: 5px 10px;
            border-radius: 3px;
            transition: color 0.15s, background 0.15s;
        }

        nav a:hover { color: var(--ink); background: var(--parchment-2); }

        nav a.active {
            color: var(--terra);
            background: var(--terra-light);
        }

        /* ─── Sidebar ─────────────────────────── */
        aside {
            position: absolute;
            top: 52px; left: 0; bottom: 0;
            width: var(--sidebar-w);
            background: rgba(242, 237, 230, 0.98);
            backdrop-filter: blur(14px);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            z-index: 9;
            padding: 20px 18px;
            transition: transform 0.3s cubic-bezier(.4,0,.2,1);
            scrollbar-width: thin;
            scrollbar-color: var(--parchment-3) transparent;
        }

        aside::-webkit-scrollbar { width: 4px; }
        aside::-webkit-scrollbar-thumb { background: var(--parchment-3); border-radius: 2px; }

        .sidebar-hidden aside { transform: translateX(-100%); }

        /* ─── Sidebar toggle ──────────────────── */
        #sidebar-toggle {
            position: absolute;
            left: calc(var(--sidebar-w) + 12px);
            top: 64px;
            z-index: 10;
            width: 28px; height: 28px;
            background: rgba(242, 237, 230, 0.98);
            border: 1px solid var(--border);
            border-radius: 50%;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 1px 6px rgba(15,12,8,0.14);
            transition: left 0.3s cubic-bezier(.4,0,.2,1), background 0.15s;
        }

        #sidebar-toggle:hover { background: var(--parchment-2); }
        .sidebar-hidden #sidebar-toggle { left: 12px; }

        .toggle-icon {
            width: 12px; height: 9px;
            display: flex; flex-direction: column;
            justify-content: space-between;
        }

        .toggle-icon span {
            display: block;
            height: 1.5px;
            background: var(--ink-muted);
            border-radius: 1px;
        }

        /* ─── Sidebar sections ────────────────── */
        .sb-section { margin-bottom: 20px; }

        .sb-section-head {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1.5px solid var(--border);
            margin-bottom: 12px;
            cursor: pointer;
            user-select: none;
        }

        .sb-section-head h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.95rem;
            font-weight: 600;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: var(--ink);
        }

        .sb-caret {
            font-size: 9px;
            color: var(--ink-faint);
            transition: transform 0.2s;
            line-height: 1;
        }

        .sb-caret.closed { transform: rotate(-90deg); }

        .sb-body {
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.25s ease;
            max-height: 800px;
            opacity: 1;
        }

        .sb-body.closed { max-height: 0; opacity: 0; }

        /* ─── Legend ──────────────────────────── */
        .legend-group { margin-bottom: 14px; }
        .legend-group:last-child { margin-bottom: 0; }

        .legend-group-label {
            font-size: 0.65rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--ink-faint);
            font-weight: 500;
            margin-bottom: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 9px;
            font-size: 0.81rem;
            color: var(--ink-muted);
            margin-bottom: 7px;
            line-height: 1.3;
        }

        .legend-item:last-child { margin-bottom: 0; }

        .legend-dot {
            width: 10px; height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .legend-dot.tribal {
            background: var(--c-tribal);
            box-shadow: 0 0 0 3px rgba(168, 68, 40, 0.18);
        }

        .legend-dot.university  { background: var(--c-university); }
        .legend-dot.museum      { background: var(--c-museum); }
        .legend-dot.federal     { background: var(--c-federal); }
        .legend-dot.state       { background: var(--c-state); }
        .legend-dot.historical  { background: var(--c-historical); }

        .legend-swatch {
            width: 12px; height: 10px;
            flex-shrink: 0;
            border-radius: 2px;
        }

        .legend-swatch.cultural {
            background: rgba(196, 146, 58, 0.35);
            border: 1.5px solid rgba(196, 146, 58, 0.9);
        }

        .legend-dash {
            width: 20px; height: 0;
            flex-shrink: 0;
            border-top: 2px dashed var(--c-affiliation);
        }

        .legend-divider {
            border: none;
            border-top: 1px solid var(--border);
            margin: 10px 0;
        }

        /* ─── Layer controls ──────────────────── */
        .layer-group {
            margin-bottom: 6px;
            border: 1px solid var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        .layer-head {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            background: white;
            cursor: pointer;
            transition: background 0.15s;
        }

        .layer-head:hover { background: var(--parchment-2); }

        .layer-head input[type="checkbox"] {
            accent-color: var(--terra);
            cursor: pointer;
        }

        .layer-head-label {
            font-size: 0.83rem;
            font-weight: 500;
            color: var(--ink);
            flex: 1;
        }

        .layer-caret {
            font-size: 8px;
            color: var(--ink-faint);
            transition: transform 0.2s;
        }

        .layer-caret.open { transform: rotate(90deg); }

        .layer-options {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.25s ease;
            background: var(--parchment);
            border-top: 1px solid var(--border);
        }

        .layer-options.open { max-height: 300px; overflow-y: auto; }

        .layer-opt {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px 6px 14px;
            font-size: 0.8rem;
            color: var(--ink-muted);
            border-bottom: 1px solid rgba(15,12,8,0.07);
            transition: background 0.12s;
        }

        .layer-opt:last-child { border-bottom: none; }
        .layer-opt:hover { background: var(--parchment-2); }

        .layer-opt input[type="checkbox"] {
            accent-color: var(--terra);
            cursor: pointer;
        }

        .layer-opt label { cursor: pointer; flex: 1; }

        .opt-pip {
            width: 8px; height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .opt-pip.square { border-radius: 2px; }

        /* ─── Popup ───────────────────────────── */
        .mapboxgl-popup-content {
            padding: 0;
            border-radius: 6px;
            box-shadow: 0 4px 20px rgba(15,12,8,0.18);
            min-width: 180px;
            overflow: hidden;
            font-family: 'DM Sans', sans-serif;
        }

        .popup-head {
            background: var(--terra);
            color: white;
            padding: 10px 14px;
        }

        .popup-head h3 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1rem;
            font-weight: 500;
            margin: 0;
        }

        .popup-body {
            padding: 12px 14px;
            font-size: 0.82rem;
            color: var(--ink-muted);
            line-height: 1.5;
        }

        .mapboxgl-popup-close-button {
            color: rgba(255,255,255,0.7);
            font-size: 16px;
            padding: 8px;
            top: 2px; right: 2px;
        }

        .mapboxgl-popup-close-button:hover { color: white; background: none; }

        .mapboxgl-ctrl-group {
            border-radius: 5px !important;
            box-shadow: 0 1px 6px rgba(15,12,8,0.14) !important;
            border: 1px solid var(--border) !important;
        }

        .sb-note {
            font-size: 0.73rem;
            color: var(--ink-faint);
            line-height: 1.5;
            padding: 10px 0 4px;
            border-top: 1px solid var(--border);
            margin-top: 4px;
        }
    </style>
</head>
<body>

    <header>
        <div class="header-title">
            <h1>Ancestral Ties</h1>
            <span>A Mapping Project</span>
        </div>
        <nav>
            <a href="index.html">Home</a>
            <a href="map.html" class="active">Map</a>
            <a href="about.html">About</a>
            <a href="source.html">Sources</a>
        </nav>
    </header>

    <button id="sidebar-toggle" aria-label="Toggle sidebar">
        <div class="toggle-icon">
            <span></span><span></span><span></span>
        </div>
    </button>

    <aside id="sidebar">

        <!-- How to Read -->
        <div class="sb-section">
            <div class="sb-section-head" onclick="toggleSection('how-to-read')">
                <h2>How to Read</h2>
                <span class="sb-caret" id="how-to-read-caret">▾</span>
            </div>
            <div class="sb-body" id="how-to-read-body">
                <p style="font-size:0.81rem; color:var(--ink-muted); line-height:1.65; margin-bottom:8px;">
                    This map visualizes NAGPRA (Native American Graves Protection and Repatriation Act) inventories and cultural affiliation claims across the United States.
                </p>
                <p style="font-size:0.81rem; color:var(--ink-muted); line-height:1.65; margin-bottom:8px;">
                    <strong style="color:var(--ink); font-weight:500;">Institutions</strong> — universities, museums, and agencies — are shown as colored dots based on type. Each holds NAGPRA inventories of human remains and cultural items.
                </p>
                <p style="font-size:0.81rem; color:var(--ink-muted); line-height:1.65; margin-bottom:8px;">
                    <strong style="color:var(--ink); font-weight:500;">Tribal Nations</strong> are shown as terracotta dots. Dashed lines connect tribes to the institutions with which they share a documented cultural affiliation.
                </p>
                <p style="font-size:0.81rem; color:var(--ink-muted); line-height:1.65;">
                    Shaded <strong style="color:var(--ink); font-weight:500;">cultural regions</strong> provide geographic and cultural context. Click any point to see inventory details and affiliation status.
                </p>
            </div>
        </div>

        <!-- Legend -->
        <div class="sb-section">
            <div class="sb-section-head" onclick="toggleSection('legend')">
                <h2>Legend</h2>
                <span class="sb-caret" id="legend-caret">▾</span>
            </div>
            <div class="sb-body" id="legend-body">

                <div class="legend-group">
                    <div class="legend-group-label">Tribal Nations</div>
                    <div class="legend-item">
                        <div class="legend-dot tribal"></div>
                        Federally Recognized Tribal Nation
                    </div>
                </div>

                <hr class="legend-divider">

                <div class="legend-group">
                    <div class="legend-group-label">Institutions</div>
                    <div class="legend-item">
                        <div class="legend-dot university"></div>
                        University / College
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot museum"></div>
                        Museum
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot federal"></div>
                        Federal Agency
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot state"></div>
                        State Agency
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot historical"></div>
                        Historical Society
                    </div>
                </div>

                <hr class="legend-divider">

                <div class="legend-group">
                    <div class="legend-group-label">Areas &amp; Connections</div>
                    <div class="legend-item">
                        <div class="legend-swatch cultural"></div>
                        Cultural Region
                    </div>
                    <div class="legend-item">
                        <div class="legend-dash"></div>
                        Cultural Affiliation (Institution ↔ Tribe)
                    </div>
                </div>

            </div>
        </div>

        <!-- Layers -->
        <div class="sb-section">
            <div class="sb-section-head" onclick="toggleSection('layers')">
                <h2>Layers</h2>
                <span class="sb-caret" id="layers-caret">▾</span>
            </div>
            <div class="sb-body" id="layers-body">

                <div class="layer-group">
                    <div class="layer-head" onclick="toggleLayerOptions('tribal-options', 'tribal-caret')">
                        <input type="checkbox" id="tribal-nations" checked onclick="event.stopPropagation(); handleLayerToggle('tribal-nations')"/>
                        <span class="layer-head-label">Tribal Nations</span>
                        <span class="layer-caret" id="tribal-caret">▶</span>
                    </div>
                    <div class="layer-options" id="tribal-options">
                        <div class="layer-opt">
                            <div class="opt-pip" style="background:var(--c-tribal)"></div>
                            <input type="checkbox" id="t-federally-recognized" checked/>
                            <label for="t-federally-recognized">Federally Recognized Tribes</label>
                        </div>
                        <div class="layer-opt">
                            <div class="opt-pip" style="background:var(--c-tribal); opacity:0.45;"></div>
                            <input type="checkbox" id="t-state-recognized" checked/>
                            <label for="t-state-recognized">State Recognized Tribes</label>
                        </div>
                    </div>
                </div>

                <div class="layer-group">
                    <div class="layer-head" onclick="toggleLayerOptions('cultural-options', 'cultural-caret')">
                        <input type="checkbox" id="cultural-regions" checked onclick="event.stopPropagation(); handleLayerToggle('cultural-regions')"/>
                        <span class="layer-head-label">Cultural Regions</span>
                        <span class="layer-caret" id="cultural-caret">▶</span>
                    </div>
                    <div class="layer-options" id="cultural-options">
                        <div class="layer-opt"><div class="opt-pip square" style="background:rgba(196,146,58,0.55);border:1px solid rgba(196,146,58,0.95)"></div><input type="checkbox" id="r-arctic" checked/><label for="r-arctic">Arctic</label></div>
                        <div class="layer-opt"><div class="opt-pip square" style="background:rgba(196,146,58,0.55);border:1px solid rgba(196,146,58,0.95)"></div><input type="checkbox" id="r-california" checked/><label for="r-california">California</label></div>
                        <div class="layer-opt"><div class="opt-pip square" style="background:rgba(196,146,58,0.55);border:1px solid rgba(196,146,58,0.95)"></div><input type="checkbox" id="r-great-basin" checked/><label for="r-great-basin">Great Basin</label></div>
                        <div class="layer-opt"><div class="opt-pip square" style="background:rgba(196,146,58,0.55);border:1px solid rgba(196,146,58,0.95)"></div><input type="checkbox" id="r-midwest" checked onchange="handleMidwestToggle(this)"/><label for="r-midwest">Midwest</label></div>
                        <div class="layer-opt"><div class="opt-pip square" style="background:rgba(196,146,58,0.55);border:1px solid rgba(196,146,58,0.95)"></div><input type="checkbox" id="r-northeast" checked/><label for="r-northeast">Northeast</label></div>
                        <div class="layer-opt"><div class="opt-pip square" style="background:rgba(196,146,58,0.55);border:1px solid rgba(196,146,58,0.95)"></div><input type="checkbox" id="r-northwest" checked/><label for="r-northwest">Northwest Coast</label></div>
                        <div class="layer-opt"><div class="opt-pip square" style="background:rgba(196,146,58,0.55);border:1px solid rgba(196,146,58,0.95)"></div><input type="checkbox" id="r-plains" checked/><label for="r-plains">Plains</label></div>
                        <div class="layer-opt"><div class="opt-pip square" style="background:rgba(196,146,58,0.55);border:1px solid rgba(196,146,58,0.95)"></div><input type="checkbox" id="r-plateau" checked/><label for="r-plateau">Plateau</label></div>
                        <div class="layer-opt"><div class="opt-pip square" style="background:rgba(196,146,58,0.55);border:1px solid rgba(196,146,58,0.95)"></div><input type="checkbox" id="r-southeast" checked/><label for="r-southeast">Southeast</label></div>
                        <div class="layer-opt"><div class="opt-pip square" style="background:rgba(196,146,58,0.55);border:1px solid rgba(196,146,58,0.95)"></div><input type="checkbox" id="r-southwest" checked/><label for="r-southwest">Southwest</label></div>
                    </div>
                </div>

                <div class="layer-group">
                    <div class="layer-head" onclick="toggleLayerOptions('inst-options', 'inst-caret')">
                        <input type="checkbox" id="institutions" checked onclick="event.stopPropagation(); handleLayerToggle('institutions')"/>
                        <span class="layer-head-label">Institutions</span>
                        <span class="layer-caret" id="inst-caret">▶</span>
                    </div>
                    <div class="layer-options" id="inst-options">
                        <div class="layer-opt"><div class="opt-pip" style="background:var(--c-university)"></div><input type="checkbox" id="i-university" checked/><label for="i-university">Universities &amp; Colleges</label></div>
                        <div class="layer-opt"><div class="opt-pip" style="background:var(--c-museum)"></div><input type="checkbox" id="i-museum" checked/><label for="i-museum">Museums</label></div>
                        <div class="layer-opt"><div class="opt-pip" style="background:var(--c-federal)"></div><input type="checkbox" id="i-federal" checked/><label for="i-federal">Federal Agencies</label></div>
                        <div class="layer-opt"><div class="opt-pip" style="background:var(--c-state)"></div><input type="checkbox" id="i-state" checked/><label for="i-state">State Agencies</label></div>
                        <div class="layer-opt"><div class="opt-pip" style="background:var(--c-historical)"></div><input type="checkbox" id="i-historical" checked/><label for="i-historical">Historical Societies</label></div>
                    </div>
                </div>

                <div class="layer-group">
                    <div class="layer-head">
                        <input type="checkbox" id="affiliations" checked onclick="handleLayerToggle('affiliations')"/>
                        <span class="layer-head-label">Cultural Affiliations</span>
                    </div>
                </div>

                <p class="sb-note">Click a layer name to show or hide sub-categories. Click any point on the map to view NAGPRA inventory details.</p>
            </div>
        </div>

    </aside>

    <div id="map"></div>

    <script>
        document.getElementById('sidebar-toggle').addEventListener('click', () => {
            document.body.classList.toggle('sidebar-hidden');
        });

        function toggleSection(name) {
            const body  = document.getElementById(name + '-body');
            const caret = document.getElementById(name + '-caret');
            body.classList.toggle('closed');
            caret.classList.toggle('closed');
        }

        function toggleLayerOptions(optionsId, caretId) {
            const opts  = document.getElementById(optionsId);
            const caret = document.getElementById(caretId);
            opts.classList.toggle('open');
            caret.classList.toggle('open');
        }

        function handleLayerToggle(layerId) {
            const checked = document.getElementById(layerId).checked;
            console.log(layerId, 'toggled:', checked);
        }

        mapboxgl.accessToken = 'pk.eyJ1IjoicnlsZWUtbGFsb25kZSIsImEiOiJjbWxheWJ5OXYwYjY0M2RxMmh1NDR5MjRxIn0.C9DGK_0soHehFbajEFkyoA';

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v11',
            center: [-98, 39],
            zoom: 3,
        });

        map.addControl(new mapboxgl.NavigationControl(), 'top-right');

        /* ── Upper Peninsula Cultural Region ───────────────────────────────
           Counties: Alger, Chippewa, Delta, Luce, Mackinac, Marquette, Schoolcraft
           Boundary traced clockwise from NW. For production use, replace with
           Census TIGER/Line data: https://www.census.gov/geographies/mapping-files/
        ──────────────────────────────────────────────────────────────────── */
        const upMichiganRegion = {
            type: 'FeatureCollection',
            features: [{
                type: 'Feature',
                properties: {
                    name: 'Central & Eastern Upper Peninsula',
                    counties: 'Alger, Chippewa, Delta, Luce, Mackinac, Marquette, Schoolcraft',
                    region: 'Great Lakes'
                },
                geometry: {
                    type: 'Polygon',
                    coordinates: [[
                        // ── West side: Marquette county (Lake Superior shore W→E) ──
                        [-87.60, 46.98],   // NW Marquette, Lake Superior shore
                        [-87.55, 46.90],
                        [-87.42, 46.82],
                        [-87.35, 46.68],   // Marquette city area, Lake Superior
                        [-87.10, 46.60],
                        // ── Alger county, Lake Superior shore ──
                        [-86.82, 46.62],
                        [-86.65, 46.57],   // Munising / Pictured Rocks
                        [-86.35, 46.60],
                        // ── Alger/Luce border, Lake Superior shore ──
                        [-86.00, 46.68],   // Grand Marais
                        [-85.75, 46.68],
                        [-85.52, 46.66],
                        // ── Luce county, Lake Superior shore ──
                        [-85.28, 46.70],
                        [-85.02, 46.78],   // Whitefish Point area
                        // ── Chippewa county, Lake Superior shore ──
                        [-84.82, 46.88],
                        [-84.65, 46.93],   // Chippewa north shore
                        [-84.50, 46.90],
                        [-84.37, 46.75],
                        // ── East side: Chippewa county (St. Marys River) ──
                        [-84.37, 46.49],   // Sault Ste. Marie
                        [-84.28, 46.35],
                        [-84.12, 46.20],
                        [-84.08, 46.05],
                        // ── SE corner: Chippewa into Mackinac (Lake Huron) ──
                        [-84.25, 45.95],
                        [-84.55, 45.88],
                        [-84.73, 45.82],   // St. Ignace / Mackinac Straits
                        // ── South shore: Mackinac & Schoolcraft (Lake Michigan) ──
                        [-85.05, 45.73],
                        [-85.30, 45.72],
                        [-85.60, 45.78],
                        [-85.88, 45.74],
                        // ── South shore: Delta county (Green Bay / Lake Michigan) ──
                        [-86.20, 45.70],
                        [-86.55, 45.65],
                        [-86.90, 45.62],   // Escanaba area
                        [-87.08, 45.62],
                        [-87.18, 45.70],
                        // ── West side: Delta / Marquette boundary going north ──
                        [-87.22, 45.90],
                        [-87.22, 46.08],   // Delta/Marquette corner
                        [-87.42, 46.10],   // Marquette SW
                        [-87.55, 46.20],
                        [-87.60, 46.50],
                        [-87.60, 46.98]    // back to NW start
                    ]]
                }
            }]
        };

        map.on('load', () => {

            map.addSource('up-michigan-region', {
                type: 'geojson',
                data: upMichiganRegion
            });

            // Fill layer
            map.addLayer({
                id: 'up-michigan-fill',
                type: 'fill',
                source: 'up-michigan-region',
                paint: {
                    'fill-color': 'rgba(196, 146, 58, 0.18)',
                    'fill-opacity': 1
                }
            });

            // Outline layer
            map.addLayer({
                id: 'up-michigan-outline',
                type: 'line',
                source: 'up-michigan-region',
                paint: {
                    'line-color': 'rgba(196, 146, 58, 0.90)',
                    'line-width': 1.5,
                    'line-dasharray': [3, 2]
                }
            });

            // Hover highlight
            map.addLayer({
                id: 'up-michigan-hover',
                type: 'fill',
                source: 'up-michigan-region',
                paint: {
                    'fill-color': 'rgba(196, 146, 58, 0.08)',
                    'fill-opacity': 0
                }
            });

            // Popup on click
            map.on('click', 'up-michigan-fill', (e) => {
                const props = e.features[0].properties;
                new mapboxgl.Popup({ offset: 8 })
                    .setLngLat(e.lngLat)
                    .setHTML(`
                        <div class="popup-head">
                            <h3>${props.name}</h3>
                        </div>
                        <div class="popup-body">
                            <p><strong>Counties:</strong> ${props.counties}</p>
                            <p><strong>Region:</strong> ${props.region}</p>
                        </div>
                    `)
                    .addTo(map);
            });

            map.on('mouseenter', 'up-michigan-fill', () => {
                map.getCanvas().style.cursor = 'pointer';
                map.setPaintProperty('up-michigan-hover', 'fill-opacity', 1);
            });

            map.on('mouseleave', 'up-michigan-fill', () => {
                map.getCanvas().style.cursor = '';
                map.setPaintProperty('up-michigan-hover', 'fill-opacity', 0);
            });

        });

        /* ── Cultural Regions parent toggle ── */
        document.getElementById('cultural-regions').addEventListener('change', (e) => {
            const vis = e.target.checked ? 'visible' : 'none';
            // Also sync the Midwest sub-checkbox
            document.getElementById('r-midwest').checked = e.target.checked;
            if (map.getLayer('up-michigan-fill'))    map.setLayoutProperty('up-michigan-fill',    'visibility', vis);
            if (map.getLayer('up-michigan-outline')) map.setLayoutProperty('up-michigan-outline', 'visibility', vis);
        });

        /* ── Midwest sub-checkbox toggle ── */
        function handleMidwestToggle(checkbox) {
            const vis = checkbox.checked ? 'visible' : 'none';
            if (map.getLayer('up-michigan-fill'))    map.setLayoutProperty('up-michigan-fill',    'visibility', vis);
            if (map.getLayer('up-michigan-outline')) map.setLayoutProperty('up-michigan-outline', 'visibility', vis);
        }
    </script>

</body>
</html>